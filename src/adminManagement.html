<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 계정 관리 - 부의 정석</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        .container-form {
            max-width: 1200px;
            margin: 80px auto;
            padding: 20px;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .admin-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .add-admin-btn {
            background-color: #1b2024;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
            border-radius: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .admin-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .admin-actions button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .edit-btn {
            background-color: #4CAF50;
            color: white;
        }

        .delete-btn {
            background-color: #f44336;
            color: white;
        }
    </style>
</head>
<body>
    <!-- 네비게이션 바 -->
    <nav class="navbar">
        <div class="container nav-content">
            <div class="nav-brand">부의 정석</div>
            <div class="nav-menu" id="navMenu">
                <!-- 메뉴는 scripts.js에서 동적으로 생성됩니다 -->
            </div>
            <select class="role-select" id="roleSelect">
                <option value="webmaster">웹마스터</option>
                <option value="admin">관리자</option>
                <option value="franchise">프렌차이즈</option>
                <option value="owner">점주님</option>
            </select>
        </div>
    </nav>

    <div class="container-form">
        <h1>관리자 계정 관리</h1>
        <button class="add-admin-btn" id="addAdminBtn">새 관리자 추가</button>

        <div class="admin-grid" id="adminGrid">
            <!-- 관리자 목록이 여기에 동적으로 추가됩니다 -->
        </div>
    </div>

    <!-- 관리자 추가/수정 모달 -->
    <div class="modal" id="adminModal">
        <div class="modal-content">
            <h2 id="modalTitle">관리자 추가</h2>
            <form id="adminForm">
                <div class="form-group">
                    <label for="full_name">이름</label>
                    <input type="text" id="full_name" required>
                </div>
                <div class="form-group">
                    <label for="user_id">아이디</label>
                    <input type="text" id="user_id" required>
                </div>
                <div class="form-group">
                    <label for="password">비밀번호</label>
                    <input type="password" id="password" required>
                </div>
                <div class="form-group">
                    <label for="email">이메일</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">전화번호</label>
                    <input type="tel" id="phone">
                </div>
                <button type="submit" class="add-admin-btn">저장</button>
                <button type="button" onclick="closeModal()">취소</button>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" type="module"></script>
    <script src="/js/scripts.js" type="module"></script>
    <script src="/js/adminManagement.js" type="module"></script>
    <script>
        // 모달 관련 함수
        function openModal() {
            document.getElementById('adminModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminForm').reset();
        }

        // 페이지 초기화
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // AdminManagement 모듈 불러오기
                const { initSupabase, getAdminList, registerAdmin, updateAdmin, deleteAdmin } = await import('./js/adminManagement.js');

                // Supabase 초기화
                await initSupabase();

                // 관리자 목록 로드
                const admins = await getAdminList();
                displayAdmins(admins);

                // 새 관리자 추가 버튼 이벤트
                document.getElementById('addAdminBtn').addEventListener('click', openModal);

                // 관리자 폼 제출 이벤트
                document.getElementById('adminForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const formData = {
                        full_name: document.getElementById('full_name').value,
                        user_id: document.getElementById('user_id').value,
                        password: document.getElementById('password').value,
                        email: document.getElementById('email').value,
                        phone: document.getElementById('phone').value
                    };

                    try {
                        await registerAdmin(formData);
                        closeModal();
                        const updatedAdmins = await getAdminList();
                        displayAdmins(updatedAdmins);
                        alert('관리자가 성공적으로 추가되었습니다.');
                    } catch (error) {
                        alert('관리자 추가 실패: ' + error.message);
                    }
                });
            } catch (error) {
                console.error('페이지 초기화 실패:', error);
                alert('페이지 로드 중 오류가 발생했습니다.');
            }
        });

        // 관리자 목록 표시 함수
        function displayAdmins(admins) {
            const grid = document.getElementById('adminGrid');
            grid.innerHTML = admins.map(admin => `
                <div class="admin-card">
                    <h3>${admin.full_name}</h3>
                    <p>아이디: ${admin.user_id}</p>
                    <p>이메일: ${admin.email}</p>
                    <p>연락처: ${admin.phone || '-'}</p>
                    <div class="admin-actions">
                        <button class="edit-btn" onclick="editAdmin('${admin.id}')">수정</button>
                        <button class="delete-btn" onclick="deleteAdmin('${admin.id}')">삭제</button>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>