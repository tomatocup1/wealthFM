import"./modulepreload-polyfill-B5Qt9EMX.js";import"./scripts-DQErhuYF.js";let o;async function s(){try{const e=await fetch("http://localhost:3000/config");if(!e.ok)throw new Error("Failed to fetch config");const t=await e.json();console.log("Config loaded:",t),o=supabase.createClient(t.SUPABASE_URL,t.SUPABASE_KEY),console.log("Supabase initialized successfully"),u()}catch(e){console.error("Failed to initialize Supabase:",e)}}async function d(){if(!o)throw new Error("Supabase is not initialized");try{const{data:e,error:t}=await o.from("customer_data").select("store_code").order("store_code",{ascending:!1}).limit(1);if(t)throw t;let n;if(e&&e.length>0){const a=e[0].store_code,r=parseInt(a.substring(3));n="AAA"+String(r+1).padStart(4,"0")}else n="AAA0001";return n}catch(e){throw console.error("매장 코드 생성 오류:",e),e}}function l(){return Math.random().toString(36).slice(-8)}function c(e){const t={store_code:e,store_name:document.getElementById("store_name").value,full_name:document.getElementById("owner_name").value,user_id:document.getElementById("email").value.split("@")[0],password_hash:l(),email:document.getElementById("email").value,phone:document.getElementById("phone").value,business_number:document.getElementById("business_number").value,business_address:document.getElementById("business_address").value,manager_name:document.getElementById("manager_name").value,manager_phone:document.getElementById("manager_phone").value,role:"owner",created_at:new Date().toISOString()},n={store_code:e,store_name:document.getElementById("store_name").value,baemin_id:document.getElementById("baemin_id").value,baemin_pw:document.getElementById("baemin_pw").value,coupang_id:document.getElementById("coupang_id").value,coupang_pw:document.getElementById("coupang_pw").value,yogiyo_id:document.getElementById("yogiyo_id").value,yogiyo_pw:document.getElementById("yogiyo_pw").value,owner_name:document.getElementById("owner_name").value,baemin_code:document.getElementById("baemin_code").value,baemin1_code:document.getElementById("baemin1_code").value,coupang_code:document.getElementById("coupang_code").value,yogiyo_code:document.getElementById("yogiyo_code").value};return{loginData:t,customerData:n}}function m(e){const n=["store_name","owner_name","manager_name","manager_phone","phone","email","business_number","business_address"].filter(a=>!e[a]);if(n.length>0)throw new Error(`다음 필수 항목을 입력해주세요:
${n.join(`
`)}`)}function u(){document.getElementById("customerForm").addEventListener("submit",async function(e){e.preventDefault();try{if(!o)throw new Error("Supabase is not initialized");const t=await d();console.log("New store code:",t);const{loginData:n,customerData:a}=c(t);m(n);const{error:r}=await o.from("login_data").insert([n]);if(r)throw r;const{error:i}=await o.from("customer_data").insert([a]);if(i)throw await o.from("login_data").delete().match({store_code:t}),i;alert(`매장이 성공적으로 등록되었습니다.
매장 코드: ${t}
초기 비밀번호: ${n.password_hash}`),window.location.reload()}catch(t){console.error("저장 오류:",t),alert(`저장 중 오류가 발생했습니다: ${t.message}`)}})}document.addEventListener("DOMContentLoaded",s);
